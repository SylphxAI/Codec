/**
 * Built-in bitmap font
 * Simple 8x8 pixel font covering ASCII printable characters
 */

import type { BitmapFont, Glyph } from './types'

// 8x8 font data for ASCII characters 32-126
// Each character is 8 bytes (8 rows of 8 bits)
const FONT_DATA: Record<number, number[]> = {
	// Space
	32: [0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00],
	// !
	33: [0x18, 0x18, 0x18, 0x18, 0x18, 0x00, 0x18, 0x00],
	// "
	34: [0x6c, 0x6c, 0x24, 0x00, 0x00, 0x00, 0x00, 0x00],
	// #
	35: [0x6c, 0x6c, 0xfe, 0x6c, 0xfe, 0x6c, 0x6c, 0x00],
	// $
	36: [0x18, 0x7e, 0xc0, 0x7c, 0x06, 0xfc, 0x18, 0x00],
	// %
	37: [0xc6, 0xcc, 0x18, 0x30, 0x60, 0xc6, 0x86, 0x00],
	// &
	38: [0x38, 0x6c, 0x38, 0x76, 0xdc, 0xcc, 0x76, 0x00],
	// '
	39: [0x18, 0x18, 0x30, 0x00, 0x00, 0x00, 0x00, 0x00],
	// (
	40: [0x0c, 0x18, 0x30, 0x30, 0x30, 0x18, 0x0c, 0x00],
	// )
	41: [0x30, 0x18, 0x0c, 0x0c, 0x0c, 0x18, 0x30, 0x00],
	// *
	42: [0x00, 0x66, 0x3c, 0xff, 0x3c, 0x66, 0x00, 0x00],
	// +
	43: [0x00, 0x18, 0x18, 0x7e, 0x18, 0x18, 0x00, 0x00],
	// ,
	44: [0x00, 0x00, 0x00, 0x00, 0x00, 0x18, 0x18, 0x30],
	// -
	45: [0x00, 0x00, 0x00, 0x7e, 0x00, 0x00, 0x00, 0x00],
	// .
	46: [0x00, 0x00, 0x00, 0x00, 0x00, 0x18, 0x18, 0x00],
	// /
	47: [0x06, 0x0c, 0x18, 0x30, 0x60, 0xc0, 0x80, 0x00],
	// 0
	48: [0x7c, 0xc6, 0xce, 0xde, 0xf6, 0xe6, 0x7c, 0x00],
	// 1
	49: [0x18, 0x38, 0x18, 0x18, 0x18, 0x18, 0x7e, 0x00],
	// 2
	50: [0x7c, 0xc6, 0x06, 0x1c, 0x70, 0xc6, 0xfe, 0x00],
	// 3
	51: [0x7c, 0xc6, 0x06, 0x3c, 0x06, 0xc6, 0x7c, 0x00],
	// 4
	52: [0x1c, 0x3c, 0x6c, 0xcc, 0xfe, 0x0c, 0x1e, 0x00],
	// 5
	53: [0xfe, 0xc0, 0xfc, 0x06, 0x06, 0xc6, 0x7c, 0x00],
	// 6
	54: [0x38, 0x60, 0xc0, 0xfc, 0xc6, 0xc6, 0x7c, 0x00],
	// 7
	55: [0xfe, 0xc6, 0x0c, 0x18, 0x30, 0x30, 0x30, 0x00],
	// 8
	56: [0x7c, 0xc6, 0xc6, 0x7c, 0xc6, 0xc6, 0x7c, 0x00],
	// 9
	57: [0x7c, 0xc6, 0xc6, 0x7e, 0x06, 0x0c, 0x78, 0x00],
	// :
	58: [0x00, 0x18, 0x18, 0x00, 0x00, 0x18, 0x18, 0x00],
	// ;
	59: [0x00, 0x18, 0x18, 0x00, 0x00, 0x18, 0x18, 0x30],
	// <
	60: [0x0c, 0x18, 0x30, 0x60, 0x30, 0x18, 0x0c, 0x00],
	// =
	61: [0x00, 0x00, 0x7e, 0x00, 0x7e, 0x00, 0x00, 0x00],
	// >
	62: [0x60, 0x30, 0x18, 0x0c, 0x18, 0x30, 0x60, 0x00],
	// ?
	63: [0x7c, 0xc6, 0x0c, 0x18, 0x18, 0x00, 0x18, 0x00],
	// @
	64: [0x7c, 0xc6, 0xde, 0xde, 0xdc, 0xc0, 0x7c, 0x00],
	// A
	65: [0x38, 0x6c, 0xc6, 0xc6, 0xfe, 0xc6, 0xc6, 0x00],
	// B
	66: [0xfc, 0xc6, 0xc6, 0xfc, 0xc6, 0xc6, 0xfc, 0x00],
	// C
	67: [0x7c, 0xc6, 0xc0, 0xc0, 0xc0, 0xc6, 0x7c, 0x00],
	// D
	68: [0xf8, 0xcc, 0xc6, 0xc6, 0xc6, 0xcc, 0xf8, 0x00],
	// E
	69: [0xfe, 0xc0, 0xc0, 0xfc, 0xc0, 0xc0, 0xfe, 0x00],
	// F
	70: [0xfe, 0xc0, 0xc0, 0xfc, 0xc0, 0xc0, 0xc0, 0x00],
	// G
	71: [0x7c, 0xc6, 0xc0, 0xce, 0xc6, 0xc6, 0x7e, 0x00],
	// H
	72: [0xc6, 0xc6, 0xc6, 0xfe, 0xc6, 0xc6, 0xc6, 0x00],
	// I
	73: [0x7e, 0x18, 0x18, 0x18, 0x18, 0x18, 0x7e, 0x00],
	// J
	74: [0x1e, 0x06, 0x06, 0x06, 0xc6, 0xc6, 0x7c, 0x00],
	// K
	75: [0xc6, 0xcc, 0xd8, 0xf0, 0xd8, 0xcc, 0xc6, 0x00],
	// L
	76: [0xc0, 0xc0, 0xc0, 0xc0, 0xc0, 0xc0, 0xfe, 0x00],
	// M
	77: [0xc6, 0xee, 0xfe, 0xd6, 0xc6, 0xc6, 0xc6, 0x00],
	// N
	78: [0xc6, 0xe6, 0xf6, 0xde, 0xce, 0xc6, 0xc6, 0x00],
	// O
	79: [0x7c, 0xc6, 0xc6, 0xc6, 0xc6, 0xc6, 0x7c, 0x00],
	// P
	80: [0xfc, 0xc6, 0xc6, 0xfc, 0xc0, 0xc0, 0xc0, 0x00],
	// Q
	81: [0x7c, 0xc6, 0xc6, 0xc6, 0xd6, 0xde, 0x7c, 0x06],
	// R
	82: [0xfc, 0xc6, 0xc6, 0xfc, 0xd8, 0xcc, 0xc6, 0x00],
	// S
	83: [0x7c, 0xc6, 0xc0, 0x7c, 0x06, 0xc6, 0x7c, 0x00],
	// T
	84: [0x7e, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x00],
	// U
	85: [0xc6, 0xc6, 0xc6, 0xc6, 0xc6, 0xc6, 0x7c, 0x00],
	// V
	86: [0xc6, 0xc6, 0xc6, 0xc6, 0x6c, 0x38, 0x10, 0x00],
	// W
	87: [0xc6, 0xc6, 0xc6, 0xd6, 0xfe, 0xee, 0xc6, 0x00],
	// X
	88: [0xc6, 0x6c, 0x38, 0x38, 0x6c, 0xc6, 0xc6, 0x00],
	// Y
	89: [0x66, 0x66, 0x66, 0x3c, 0x18, 0x18, 0x18, 0x00],
	// Z
	90: [0xfe, 0x0c, 0x18, 0x30, 0x60, 0xc0, 0xfe, 0x00],
	// [
	91: [0x3c, 0x30, 0x30, 0x30, 0x30, 0x30, 0x3c, 0x00],
	// \
	92: [0xc0, 0x60, 0x30, 0x18, 0x0c, 0x06, 0x02, 0x00],
	// ]
	93: [0x3c, 0x0c, 0x0c, 0x0c, 0x0c, 0x0c, 0x3c, 0x00],
	// ^
	94: [0x10, 0x38, 0x6c, 0xc6, 0x00, 0x00, 0x00, 0x00],
	// _
	95: [0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xfe],
	// `
	96: [0x18, 0x18, 0x0c, 0x00, 0x00, 0x00, 0x00, 0x00],
	// a
	97: [0x00, 0x00, 0x7c, 0x06, 0x7e, 0xc6, 0x7e, 0x00],
	// b
	98: [0xc0, 0xc0, 0xfc, 0xc6, 0xc6, 0xc6, 0xfc, 0x00],
	// c
	99: [0x00, 0x00, 0x7c, 0xc6, 0xc0, 0xc6, 0x7c, 0x00],
	// d
	100: [0x06, 0x06, 0x7e, 0xc6, 0xc6, 0xc6, 0x7e, 0x00],
	// e
	101: [0x00, 0x00, 0x7c, 0xc6, 0xfe, 0xc0, 0x7c, 0x00],
	// f
	102: [0x1c, 0x36, 0x30, 0x78, 0x30, 0x30, 0x30, 0x00],
	// g
	103: [0x00, 0x00, 0x7e, 0xc6, 0xc6, 0x7e, 0x06, 0x7c],
	// h
	104: [0xc0, 0xc0, 0xfc, 0xc6, 0xc6, 0xc6, 0xc6, 0x00],
	// i
	105: [0x18, 0x00, 0x38, 0x18, 0x18, 0x18, 0x3c, 0x00],
	// j
	106: [0x06, 0x00, 0x0e, 0x06, 0x06, 0x66, 0x66, 0x3c],
	// k
	107: [0xc0, 0xc0, 0xcc, 0xd8, 0xf0, 0xd8, 0xcc, 0x00],
	// l
	108: [0x38, 0x18, 0x18, 0x18, 0x18, 0x18, 0x3c, 0x00],
	// m
	109: [0x00, 0x00, 0xec, 0xfe, 0xd6, 0xc6, 0xc6, 0x00],
	// n
	110: [0x00, 0x00, 0xfc, 0xc6, 0xc6, 0xc6, 0xc6, 0x00],
	// o
	111: [0x00, 0x00, 0x7c, 0xc6, 0xc6, 0xc6, 0x7c, 0x00],
	// p
	112: [0x00, 0x00, 0xfc, 0xc6, 0xc6, 0xfc, 0xc0, 0xc0],
	// q
	113: [0x00, 0x00, 0x7e, 0xc6, 0xc6, 0x7e, 0x06, 0x06],
	// r
	114: [0x00, 0x00, 0xdc, 0xe6, 0xc0, 0xc0, 0xc0, 0x00],
	// s
	115: [0x00, 0x00, 0x7e, 0xc0, 0x7c, 0x06, 0xfc, 0x00],
	// t
	116: [0x30, 0x30, 0x7c, 0x30, 0x30, 0x36, 0x1c, 0x00],
	// u
	117: [0x00, 0x00, 0xc6, 0xc6, 0xc6, 0xc6, 0x7e, 0x00],
	// v
	118: [0x00, 0x00, 0xc6, 0xc6, 0xc6, 0x6c, 0x38, 0x00],
	// w
	119: [0x00, 0x00, 0xc6, 0xc6, 0xd6, 0xfe, 0x6c, 0x00],
	// x
	120: [0x00, 0x00, 0xc6, 0x6c, 0x38, 0x6c, 0xc6, 0x00],
	// y
	121: [0x00, 0x00, 0xc6, 0xc6, 0xc6, 0x7e, 0x06, 0x7c],
	// z
	122: [0x00, 0x00, 0xfe, 0x0c, 0x38, 0x60, 0xfe, 0x00],
	// {
	123: [0x0e, 0x18, 0x18, 0x70, 0x18, 0x18, 0x0e, 0x00],
	// |
	124: [0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x00],
	// }
	125: [0x70, 0x18, 0x18, 0x0e, 0x18, 0x18, 0x70, 0x00],
	// ~
	126: [0x76, 0xdc, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00],
}

/**
 * Create glyph from font data
 */
function createGlyph(char: number, data: number[]): Glyph {
	const bitmap = new Uint8Array(8)
	for (let i = 0; i < 8; i++) {
		bitmap[i] = data[i]!
	}

	return {
		char,
		width: 8,
		height: 8,
		xOffset: 0,
		yOffset: 0,
		advance: 8,
		bitmap,
	}
}

/**
 * Get the built-in 8x8 font
 */
export function getBuiltinFont(): BitmapFont {
	const glyphs = new Map<number, Glyph>()

	for (const [char, data] of Object.entries(FONT_DATA)) {
		const charCode = Number.parseInt(char)
		glyphs.set(charCode, createGlyph(charCode, data))
	}

	// Create default glyph (filled rectangle)
	const defaultGlyph: Glyph = {
		char: 0,
		width: 8,
		height: 8,
		xOffset: 0,
		yOffset: 0,
		advance: 8,
		bitmap: new Uint8Array([0xfe, 0x82, 0x82, 0x82, 0x82, 0x82, 0xfe, 0x00]),
	}

	return {
		name: 'Built-in 8x8',
		size: 8,
		lineHeight: 10,
		baseline: 8,
		glyphs,
		defaultGlyph,
	}
}

// Cache the built-in font
let builtinFont: BitmapFont | null = null

/**
 * Get cached built-in font
 */
export function getDefaultFont(): BitmapFont {
	if (!builtinFont) {
		builtinFont = getBuiltinFont()
	}
	return builtinFont
}
